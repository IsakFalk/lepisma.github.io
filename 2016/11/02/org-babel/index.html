<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
    Cheap polyglot notebooks &#8211; abhinav tushar
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Personal Blog">
  <meta name="author" content="Abhinav Tushar">
  <meta name="keywords" content="">
  <link rel="canonical" href="https://lepisma.github.io//2016/11/02/org-babel/">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/pace.css" type="text/css">
  <link rel="stylesheet" href="/assets/css/lightbox.css" type="text/css">
  <link rel="stylesheet" href="/assets/css/animate.min.css" type="text/css">
  <link rel="stylesheet" href="/css/blog.css" type="text/css">

  <!-- Favicons -->
<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/images/favicons/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/favicons/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/favicons/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/favicons/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/images/favicons/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/images/favicons/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/images/favicons/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/images/favicons/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="/assets/images/favicons/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/assets/images/favicons/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/assets/images/favicons/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/assets/images/favicons/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/assets/images/favicons/mstile-310x310.png" />


  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,800" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono" rel="stylesheet">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="/assets/js/pace.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script src="/assets/js/lightbox.min.js"></script>
  <script src="/assets/js/jquery.lettering-0.6.1.min.js"></script>
  <script src="/assets/js/jquery.textillate.js"></script>
  <script src="/assets/js/custom.js"></script>

  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Cheap polyglot notebooks">
  <meta property="og:description" content="Personal Blog">
  <meta property="og:url" content="https://lepisma.github.io//2016/11/02/org-babel/">
  <meta property="og:site_name" content="abhinav tushar">

  <meta name="twitter:url" content="https://lepisma.github.io//2016/11/02/org-babel/">
  <meta name="twitter:title" content="Cheap polyglot notebooks">
  <meta name="twitter:description" content="Personal Blog">

  <meta itemprop="name" content="Cheap polyglot notebooks">
  <meta itemprop="description" content="Personal Blog">
</head>

  <body>
    <div class="site-wrap">
      <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <span class="site-title">
        <a href="/">
          <img src="/assets/images/avatar32.png">
        </a>
      </span>
      <nav class="site-nav right">
        <a href="/">home</a>
<a href="/feed.xml">feed</a>
<a href="/archive">archive</a>
<a href="/about/">about</a>

      </nav>
      <div class="clearfix"></div>
    </div>
  </div>
</header>


      <div class="post p2 p-responsive wrap" role="main">
        <div class="measure">
          


<div class="post-header mb2">
  <h1>Cheap polyglot notebooks</h1>
  <div class="post-tags">
    <a href="/archive/org-mode/" rel="tag">org-mode</a> <a href="/archive/emacs/" rel="tag">emacs</a> <a href="/archive/tooling/" rel="tag">tooling</a> <a href="/archive/programming/" rel="tag">programming</a>
  </div>
  <span class="post-meta small">Nov 2, 2016</span><br>
  <span class="post-meta small">7 minute read</span>
</div>

<article class="post-content">
  <p class="post-intro">
As compared to json based jupyter notebooks, Emacs org-mode provides a much more
readable and lighter notebook with multiple language support using org-babel.
Just like RMarkdown, but in Emacs.
</p>
<!--more-->

<p><span class="dropcap">R</span>Studio v1.0
is <a href="https://blog.rstudio.org/2016/11/01/announcing-rstudio-v1-0/">released</a>. One
of the key features is
the <a href="http://rmarkdown.rstudio.com/r_notebooks.html">notebook</a>. Yes, there is
a <a href="https://irkernel.github.io/">Jupyter kernel</a> for R, but this is probably
going to be much better.</p>

<p>The idea of having interactive notebooks is not really new. Mathematica had it
before I was born or something. IPython and then Jupyter
brought these to the mainstream. Now almost every product on these lines have great
many features including cool visualization support, multiple kernels (many in
the same notebook) etc. You have some big products
like
<a href="http://beakernotebook.com/">beaker</a>, <a href="https://zeppelin.apache.org/">zeppelin</a>
and of course <a href="https://jupyter.org/">Jupyter</a>.</p>

<p>Everything is fine. But I don’t particularly enjoy it when I accidently open a
notebook in my editor and its a mess of JSON waiting to force me into believing
that its just a set of simple scripts I wrote to do something much simpler
than</p>

<blockquote>
  <p>working interactively with large and complex datasets</p>
</blockquote>

<p><a href="http://rmarkdown.rstudio.com/">R Markdowns</a> shine here. They are by default
cleaner to read. So that’s a plus. What else do you need? Well, R is not a
general purpose language. Neither is python good for everything. A notebook
supporting multiple languages? That will work. But then they are too heavy to
open up everything and get going. Honestly, they are not targeting your tiny
scripts crossing and piping data over language barriers to make sense of your
local files or sating your fussiness for
using <a href="http://docs.python-requests.org/en/master/">requests</a>
over <a href="https://github.com/request/request">request</a>. Notebooks simply have great
overheads for small experiments with random jumble of scripts.</p>

<h2 id="org-babel">Org-babel</h2>

<p><a href="http://orgmode.org/worg/org-contrib/babel/">Org-babel</a> is
an <a href="http://orgmode.org/">Org-mode</a> thing for running chunks of code in Org
files. You could add language chunks, like in R Markdowns, and execute those with
optional shared sessions or variable passing. So, for example, you could get
around with your <em>ggplot envy</em> while using Python
(at least until <a href="https://github.com/altair-viz/altair">altair</a> goes on big).
Anyways, the point is not heavy plotting (those are much better on web based
UIs), its the speed with which you can play around with your ideas inside org
files.</p>

<p>You could use JS, Python and other languages with great packages and weave them
with your writings or class notes in Org with <script type="math/tex">\LaTeX</script>. Additionally, being
inside Emacs, you could exploit Emacs lisp and Org to have cool side effects with
ease. For example, shifting your scheduled tasks depending on weather gathered
using python requests. Obviously there are other ways. Get data with Elisp
itself, or use something like <a href="https://github.com/bjonnh/PyOrgMode">PyOrgMode</a>.
But you might really love <em>requests</em> for http things and want to use Emacs’
buffer manipulation for writing to files. And you might want this weather
dependent org agenda file to be self contained. Or you are of the other
type and might be okay with firing up (or planning to) different processes and
piping everything externally.</p>

<p>I recently started trying out Babel for some of the use cases involving
web-scraping, some <em>pythonish</em> things, some directory restructuring and some
planning and writing. As of now, I am really enjoying the neat polyglot
<em>notebookish</em> properties with great many freedoms for plumbing code with prose.</p>

<p>Here is a quick preview for generating some results in Python</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#+NAME: chunks</span>
<span class="c">#+BEGIN_SRC python :results silent</span>
  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="n">animals</span> <span class="o">=</span> <span class="p">[</span><span class="s">"doge"</span><span class="p">,</span> <span class="s">"moon moon"</span><span class="p">,</span> <span class="s">"pepe"</span><span class="p">,</span> <span class="s">"grumpy cat"</span><span class="p">]</span>
  <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://google.com/search?q="</span> <span class="o">+</span> <span class="n">animal</span> <span class="o">+</span> <span class="s">" meme"</span><span class="p">)</span>
    <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">animal</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">chunks</span>
<span class="c">#+END_SRC</span>
</code></pre>
</div>

<p>You have your usual org code block with few specifications (like <code class="highlighter-rouge">NAME</code> for variable
name to be used for the block result). Essentially this snip is counting Google
search hits for “[name] meme” for different <code class="highlighter-rouge">names</code>. It uses <em>requests</em> to get
the search results. Now for parsing the HTML element which says something like “About
100 results found”, lets pass the results to JS</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="err">#</span><span class="o">+</span><span class="nx">NAME</span><span class="err">:</span> <span class="nx">counts</span>
<span class="err">#</span><span class="o">+</span><span class="nx">BEGIN_SRC</span> <span class="nx">js</span> <span class="err">:</span><span class="kd">var</span> <span class="nx">data</span><span class="o">=</span><span class="nx">chunks</span> <span class="err">:</span><span class="nx">cmd</span> <span class="nx">babel</span><span class="o">-</span><span class="nx">node</span> <span class="err">:</span><span class="nx">results</span> <span class="nx">list</span>
  <span class="kr">const</span> <span class="nx">cheerio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"cheerio"</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="nx">cheerio</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="s2">"#resultStats"</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">text</span><span class="p">()</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
<span class="err">#</span><span class="o">+</span><span class="nx">END_SRC</span>

<span class="err">#</span><span class="o">+</span><span class="nx">RESULTS</span><span class="err">:</span> <span class="nx">counts</span>
<span class="o">-</span> <span class="p">(</span><span class="s2">"doge"</span> <span class="s2">"735000"</span><span class="p">)</span>
<span class="o">-</span> <span class="p">(</span><span class="s2">"moon moon"</span> <span class="s2">"3420000"</span><span class="p">)</span>
<span class="o">-</span> <span class="p">(</span><span class="s2">"pepe"</span> <span class="s2">"775000"</span><span class="p">)</span>
<span class="o">-</span> <span class="p">(</span><span class="s2">"grumpy cat"</span> <span class="s2">"1250000"</span><span class="p">)</span>
</code></pre>
</div>

<p>Nice. It works. We could go back to python and do a frequency plot because we
have problems counting number of zeros.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#+BEGIN_SRC python :var counts=counts :results file :export both</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">sns</span><span class="o">.</span><span class="nb">set</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"plot.png"</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">return</span> <span class="s">"plot.png"</span>
<span class="c">#+END_SRC</span>

<span class="c">#+RESULTS:</span>
<span class="p">[[</span><span class="nb">file</span><span class="p">:</span><span class="n">plot</span><span class="o">.</span><span class="n">png</span><span class="p">]]</span>
</code></pre>
</div>

<figure>
<a href="/images/posts/babel/pyplot.png" data-lightbox="method"><img src="/images/posts/babel/pyplot.png" /></a>
</figure>

<p>There are many languages supported and you have the
usual org structures like tables and lists for mediating chunks. The working
model is really simple. Even the plotting is nothing more than writing to file
and displaying with the usual org-inline image toggle. But, that is
expressive enough. Here is another screen using R and ggplot (plot taken
from <a href="http://docs.ggplot2.org/0.9.3/stat_binhex.html">hexbin</a> example). You
could also put in something weird like C++.</p>

<figure>
<a href="/images/posts/babel/rplot.png" data-lightbox="method"><img src="/images/posts/babel/rplot.png" /></a>
</figure>

<p>All in all, these files are cheap, readable and usable. Exportable to any format
imaginable. And these integrate deeply with your usual Emacs + Org-mode workflow.</p>

<hr />

<p>Org files are not ‘the’ polyglot notebooks. They don’t solve everything and of
course not everyone uses Emacs. They are limited in many aspects, for example
visualizations. But they let you do a few things in a <em>notebookish</em> manner which
would have been a mess otherwise.</p>

<p>I used to do <em>many</em> things in Jupyter notebooks before I learned easier
non-python alternatives for quick tasks. Some time after that I switched to
Emacs and realized I don’t like editing in browser that much and
the <a href="https://tkf.github.io/emacs-ipython-notebook/">ipython-notebook mode</a> was
not much fun either. Org-babel looks great now. It sits nicely in between and
fills many gaps. In case you are having certain likelihood of getting hooked too,
try these <a href="https://github.com/dfeich/org-babel-examples">samples</a>.</p>

<p><a href="https://gist.githubusercontent.com/lepisma/6157074b8cec0eecfcc97555ac72289c/raw/ca39f3715b714d28ff138c49946b2188bf00e7f5/ob.org">Here</a> is
the notebook I used.</p>

</article>

        </div>
      </div>
    </div>

    <footer class="footer">
</footer>

  </body>
</html>
