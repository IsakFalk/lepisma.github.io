<!DOCTYPE html>
<html><head><meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="Personal Blog"/>
<meta name="author" content="Abhinav Tushar"/>
<meta name="keywords" content=""/>
<link rel="canonical" href="http://localhost:4000/2017/06/25/simple-time-maps/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Simpler time map plots"/>
<meta property="og:description" content="Personal Blog"/>
<meta property="og:url" content="http://localhost:4000/2017/06/25/simple-time-maps/"/>
<meta property="og:site_name" content="abhinav tushar"/>
<meta name="twitter:url" content="http://localhost:4000/2017/06/25/simple-time-maps/"/>
<meta name="twitter:title" content="Simpler time map plots"/>
<meta name="twitter:description" content="Personal Blog"/>
<meta itemprop="name" content="Simpler time map plots"/>
<meta itemprop="description" content="Personal Blog"/>
  <title>Simpler time map plots &#8211; abhinav tushar</title>
  <link rel="stylesheet" href="/assets/css/pace.css" type="text/css"/>
  <link rel="stylesheet" href="/css/blog.css" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css"/><link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/images/favicons/apple-touch-icon-57x57.png"/>
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/favicons/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/favicons/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/favicons/apple-touch-icon-144x144.png"/>
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/images/favicons/apple-touch-icon-60x60.png"/>
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/images/favicons/apple-touch-icon-120x120.png"/>
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/images/favicons/apple-touch-icon-76x76.png"/>
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/images/favicons/apple-touch-icon-152x152.png"/>
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-196x196.png" sizes="196x196"/>
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-96x96.png" sizes="96x96"/>
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32"/>
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16"/>
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-128.png" sizes="128x128"/>
<meta name="application-name" content="&amp;nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF"/>
<meta name="msapplication-TileImage" content="/assets/images/favicons/mstile-144x144.png"/>
<meta name="msapplication-square70x70logo" content="/assets/images/favicons/mstile-70x70.png"/>
<meta name="msapplication-square150x150logo" content="/assets/images/favicons/mstile-150x150.png"/>
<meta name="msapplication-wide310x150logo" content="/assets/images/favicons/mstile-310x150.png"/>
<meta name="msapplication-square310x310logo" content="/assets/images/favicons/mstile-310x310.png"/><!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,800" rel="stylesheet"/>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono" rel="stylesheet"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="/assets/js/pace.min.js"></script>
  <script src="/assets/js/jquery.zoomooz.min.js"></script>
<script src="http://127.0.0.1:35729/livereload.js"></script></head>
  <body>
    <div class="site-wrap"><header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure"><span class="site-title"><a href="/"><img src="/assets/images/avatar32.png"/></a></span>
      <nav class="site-nav right"><a href="/pile/">pile</a><a href="/feed.xml">feed</a><a href="/archive">blog</a><a href="/about/">about</a></nav>
      <div class="clearfix"></div>
    </div>
  </div>
</header>
      <div class="post p2 p-responsive wrap" role="main">
        <div class="measure">

<div class="post-header mb2">
  <div class="post-meta small">Jun 25, 2017</div>
  <div class="post-meta small">6 minute read</div>
  <h1>Simpler time map&nbsp;plots</h1>
  <div class="post-tags"><a href="/archive/exploration/" rel="tag">exploration</a> <a href="/archive/viz/" rel="tag">viz</a></div>
</div>
<article class="post-content"><p class="post-intro">
Proposing a one dimensional version of <a href="https://districtdatalabs.silvrback.com/time-maps-visualizing-discrete-events-across-many-timescales">time
map</a>
plots which doesn’t lose any information displayed in most cases and is cleaner
to understand.
</p>
<!--more-->

<p><span class="dropcap">B</span>ehavior of time series is tricky to judge from
simple plots. The process generating the series can have multiple underlying
mechanics and simple plots make it hard to discern these. Sometime back I read
about
<a href="https://districtdatalabs.silvrback.com/time-maps-visualizing-discrete-events-across-many-timescales">time maps</a>,
which try to solve a part of this problem (I encourage you to read that post
before this one). Time maps target visualizing time differences between discrete
events. This is helpful, for example, to see if there are multiple modes in the
repetition of some events. If on a single day you eat 5 times from 9 AM to 11 AM
and call it a day, your eating time plot will have repetitions for those small
intervals <em>and</em> for the daily one. A time map captures these two modes easily.</p>

<p>Consider the following time series. The x axis shows date and the y axis shows
my lastfm <a href="https://www.last.fm/user/abhinavtushar">scrobbles</a> per day.</p>

<figure><div id="counts-lfm"></div><figcaption>
    <p>My daily lastfm scrobbles</p>
  </figcaption></figure>

<p>Nothing much to it. If I plot it as a time map, I get this</p>

<aside>
  <p>Scale is log; sorry
for the <em>not that useful</em> tick labels in this whole post,
<a href="https://github.com/lepisma/tufte.js/issues/21">will fix it</a>.</p>
</aside>

<figure><div id="diffs-lfm-vanilla"></div><figcaption>
    <p>Scrobbles time map</p>
  </figcaption></figure>

<p>Each dot here is a listen. The <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> value being the time
difference between it and the previous listen, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> being
the difference with next listen. Note that the plot is log scaled (thus the
repeated pattern in lower values) which helps us understand the diffs at
multiple scales.</p>

<p>Another important point is the <em>almost</em> symmetry along <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x = y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> line. When you use the <em>pre-event</em> and <em>post-event</em> time diffs of
each event as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> value
for plotting, one points <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> will be previous one’s
(according to event ordering) <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> value. Now this has
consequences on whether a time map is useful for you. What follows is the same
plot with marginal histograms along the axis. No doubt the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> marginals are similar. This is not
because of the data but because of the way both axis values are derived,
resulting in a non-exact symmetry.</p>

<figure><div id="diffs-lfm"></div><figcaption>
    <p>Time map with marginals</p>
  </figcaption></figure>

<p>Think about a point in top left corner. This refers to an event which was
preceded by another event shortly but is followed by the next event after a long
time gap. The opposite happens with point in bottom right. Because adjacent
events share <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>, the mass
of points has similar distributions (notice that this is not the case with very
few points). Unless you are displaying another data dimension using color / size
of the circles (like in the original
<a href="https://districtdatalabs.silvrback.com/time-maps-visualizing-discrete-events-across-many-timescales">blog</a>,
where we see points colored according to the time of day), the two dimensions
here just add to the visual clutter.</p>

<hr />

<p>Lets tweak the lastfm data a little bit. Now, the scrobbles are filtered to show
only the first listen of each song. To give this some meaning, a lot of these
<em>filtered</em> scrobbles in a short time span would mean that I explored more as
compared to repeating the same old songs.</p>

<figure><div id="diffs-lfm-dd"></div><figcaption>
    <p>First listen time maps</p>
  </figcaption></figure>

<p>Notice how easy it is to find the bumps in the marginal plot. A plot of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> marginal follows.</p>

<figure><div id="dd-hist"></div><figcaption>
    <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> marginal plot of first listens</p>
  </figcaption></figure>

<p>As a side note this plot makes me wonder about the origin of the bumps. The
initial rise up to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">x = 3, 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathrm">3</span><span class="mpunct">,</span><span class="mord mathrm">4</span></span></span></span> (around 20, 50 minutes) is
mostly due to radios listens (which give you fresh songs frequently) or binging
on some new album/artist. The one around 7 (around 18 hours) might be a
<em>session</em> change. A new session, with fresh items probably. Need to dig in the
actual songs to understand this.</p>

<h1 id="tweets">Tweets</h1>

<p>The original blog made a time map for tweets
of <a href="https://twitter.com/BarackObama">@BarackObama</a>. I did a re-crawl. Here is
the time plot of tweets per day.</p>

<figure><div id="counts-tw"></div><figcaption>
    <p>Tweets per day <a href="https://twitter.com/BarackObama">@BarackObama</a></p>
  </figcaption></figure>

<p>Next is the full time map for the series.</p>

<figure><div id="diffs-tw"></div><figcaption>
    <p>Tweets time map <a href="https://twitter.com/BarackObama">@BarackObama</a></p>
  </figcaption></figure>

<p>As argued earlier, unless we are showing extra information, its much easier to
see the marginal to get the frequency behavior of the series. See the plot
below.</p>

<figure><div id="tw-hist"></div><figcaption>
    <p>Tweets time map 1D <a href="https://twitter.com/BarackObama">@BarackObama</a></p>
  </figcaption></figure>

<h1 id="gotchas">Gotchas</h1>

<ul>
  <li>Making sense of a histogram in log scale (the kind I used, with uniform bins
over log scaled data; You can have non-uniform, log scaled bins too. I haven’t
tried that) is tricky. The bins and density don’t exactly go as you would
think. Additionally you would see repeated pattern (exposing the discrete
values) in the beginning and smoothing in the end. More rigorous analysis
should be done to derive something other than qualitative meanings from these.</li>
  <li>Add to it the number-of-bins problem. Plots above
use
<a href="https://en.wikipedia.org/wiki/Freedman%E2%80%93Diaconis_rule">Freedman-Diaconis rule</a> to
get the number of bins. Changing this number can result in different views
as shown below.</li>
</ul>

<figure><div id="tw-hist-less"></div><figcaption>
    <p>Tweets time map with 10 bins</p>
  </figcaption></figure>

<figure><div id="tw-hist-more"></div><figcaption>
    <p>Tweets time map with 200 bins</p>
  </figcaption></figure>

<hr />

<p>Time maps are neat exploratory tools. To me, they have more qualitative value
than quantitative. Most of the visualizations with more than a few dozen points
make more sense qualitatively and are better without unnecessary details, that’s
why we prefer heatmaps instead of regular scatter in certain cases. A marginal
time map follows the same idea.</p>

<script src="https://d3js.org/d3.v4.min.js"></script>

<script src="/scripts/posts/time-maps/tufte.min.js"></script>

<script src="/scripts/posts/time-maps/script.js"></script
</script>
</article></div>
      </div>
    </div>
    <footer class="footer"></footer>
  </body>
</html>